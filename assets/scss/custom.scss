//Global vars
$sunburst-color1: darkorange;
$sunburst-color2: orange;
$text-color-primary: black;
$button-color-primary: #622424;
$button-color-primary-active: darken($button-color-primary, 2.5%);
$form-el-color-shadow: rgba(0, 0, 0, .5);
$tilt-left: rotate(-15deg);
$tilt-right: rotate(15deg);
$raised-bg-top: 34%;
$title-margin-bottom: 1em;


@function do-background($color1, $color2, $deg) {
  $i: 180 - $deg;
  $bg: "";
  $current-color: $color1;

  @while $i >= 0 {
    $bg: $bg + 'linear-gradient(#{$i}deg, transparent 50%, #{$current-color} 50%, #{$current-color} 100%), ';
    $i:$i - $deg;

    $current-color : if($current-color == $color1, $color2, $color1);
  }

  $punultimate-idx: str_length($bg) - 2;

  @return unquote(str_slice($bg, 0, $punultimate-idx));
}

@mixin copy-type {
  font-family: 'Montserrat', sans-serif;
}

@mixin title-type {
  font-family: 'Fugaz One', cursive;
  color: $text-color-primary;
}

@mixin full-screen {
  height: 100%;
  overflow: hidden;
  position: absolute;
  width: 100%;
}

@mixin flex-center {
  align-items: center;
  display: flex;
  justify-content: center;
}

@keyframes spin {
  from {
    transform: translate(-50%, -50%) rotate(0deg);
  }

  to {
    transform: translate(-50%, -50%) rotate(360deg);
  }
}

html {
  @include copy-type;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  width: 100%;
}

.pad-0 {
  padding: 0;
}

h1, h2, h3 {
  @include title-type;
}

.button,
.input {
  box-shadow: $form-el-color-shadow 0 2pt 2pt;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  &::placeholder {
    color: #363636;
  }
}

.button.is-primary {
  background-color: $button-color-primary;

  &:hover,
  &:active {
    background-color: $button-color-primary-active;
  }
}

.sunburst {
  @include full-screen;

  @keyframes raiseSunburst {
    100% {
      top: $raised-bg-top;
    }
  }

  .inner {
    animation: spin 45s linear infinite paused;
    height: 300%;
    left: 50%;
    position: absolute;
    top: 44%;
    transform: translate(-50%, -50%);
    width: 300%;

    &.animated {
      animation-play-state: running;
    }

    .gradient-wrap {
      height: 50%;
      overflow: hidden;
      width: 100%;

      &:last-child {
        transform: rotate(180deg);
      }
    }

    .gradient {
      background: do-background($sunburst-color1, $sunburst-color2, 10);
      height: 200%;
      width: 100%;
    }
  }

  &.raise {
    .inner {
      animation: raiseSunburst forwards ease-in-out 1 .75s ;
    }
  }

  &.is-raised {
    .inner {
      top: $raised-bg-top;
    }
  }
}

.starburst {
  @include flex-center;

  text-align: center;

  ::before,
  ::after {
    background: inherit;
    content: "";
    height: 100%;
    left: 0;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: -1;
  }

  ::before {
    transform: rotate(30deg);
  }

  ::after {
    transform: rotate(-30deg);
  }
}

.section {
  .step {
    @include full-screen;

    @include flex-center;

    @mixin anim-props($anim, $direction, $count: 1, $duration: .25s) {
      animation: $anim $direction $duration;
      animation-iteration-count: $count;
    }

    @keyframes animScaleUp {
      100% {
        transform: scale(1.25);
      }
    }

    @keyframes animShake0 {
      0% {
        transform: rotate(-15deg);
      }
      100% {
        transform: rotate(15deg);
      }
    }

    @keyframes animShake1 {
      0% {
        transform: $tilt-right;
      }
      100% {
        transform: $tilt-left;
      }
    }

    @keyframes animSpin1{
      0% {
        transform: rotateY(0);
      }
      49% {
        transform: rotateY(90deg);
      }
      50% {
        transform: rotateY(-90deg);
      }
      100% {
        transform: rotateY(-0);
      }
    }

    .scale-0 {
      @include anim-props(animScaleUp, alternate, 2)
    }

    .spin-1 {
      @include anim-props(animSpin1, normal, 4)
    }

    h1 {
      bottom: $title-margin-bottom;
      font-size: 13.333vw;
      position: absolute;
      text-align: center;
      text-shadow: white 0 2pt 2pt;
      width: 100%;
    }

    .bottle {
      height: 100vw;
      left: -15vw;
      max-width: none;
      position: absolute;
      top: 12.5vw; //25vw;

      &.rotated-0 {
        transform: $tilt-left;
      }
      &.rotated-1 {
        transform: $tilt-right;
      }

      @mixin shake-props($anim) {
        @include anim-props($anim, alternate, 4, .25s);
      }

      &.shake-0 {
        @include shake-props(animShake0)
      }

      &.shake-1 {
        @include shake-props(animShake1)
      }

      &.tilt-0 {
        @include anim-props(anim-tilt-item-left, forwards ease-in-out, 1, .125s);
      }

      &.tilt-1 {
        @include anim-props(anim-tilt-item-right, forwards ease-in-out, 1, .125s);
      }

      &.un-tilt-0 {
        @include anim-props(anim-tilt-item-left, reverse ease-in-out, 1, .125s);
      }

      &.un-tilt-1 {
        @include anim-props(anim-tilt-item-right, reverse ease-in-out, 1, .125s);
      }
    }

    form {
      @include flex-center;

      .formfield {
        bottom: 1em;
        position: absolute;
        width: 90vw;

        .input.is-fullwidth {
          position: relative;
          top: -.5em;
        }
      }
    }

    .details {
      position: absolute;
      text-align: center;
    }

    &.raise {
      h1 {
        bottom: 3.5em;
      }

      .details {
        bottom: 7.5em;
      }
    }
}

  #ad-steps {
    position: initial;
  }


  @keyframes anim-flip-title {
    0% {
      bottom: 0;
      transform: rotateX(90deg);
    }
    100% {
      bottom: $title-margin-bottom;
      transform: rotateX(0deg);
    }
  }

  @mixin anim-side-by-value($animSide, $amount) {
    100% {
      #{$animSide}: #{$amount};
    }
  }

  @keyframes anim-tilt-item-left {
    @include anim-side-by-value(transform, $tilt-left);
  }

  @keyframes anim-tilt-item-right {
    @include anim-side-by-value(transform, $tilt-right);
  }

  @keyframes anim-tilt-item-center {
    @include anim-side-by-value(transform, 0deg);
  }

  @keyframes anim-exit-title-to-bottom {
    @include anim-side-by-value(bottom, -1.5em);
  }

  @keyframes anim-exit-bottle-to-top {
    @include anim-side-by-value(top, -95vw);
  }

  @keyframes anim-exit-form-to-bottom {
    @include anim-side-by-value(bottom, -5em);
  }

  @keyframes anim-exit-coin-pile-to-top {
    @include anim-side-by-value(top, -19em);
  }

  @mixin hide-h1($time) {
    h1 {
      animation: forwards anim-exit-title-to-bottom ease-in-out $time;
    }
  }

  $coin-pile-tier-0-top: 0;
  $coin-pile-tier-1-top: 1em;
  $coin-pile-tier-2-top: -2.75em;
  $coin-pile-tier-3-top: -4.5em;

  #coin-pile {
    @keyframes anim-enter-coin-pile-coin-0 {
      @include anim-side-by-value(top, $coin-pile-tier-0-top)
    }
    @keyframes anim-enter-coin-pile-coin-1 {
      @include anim-side-by-value(top, $coin-pile-tier-0-top)
    }

    @keyframes anim-enter-coin-pile-coin-2 {
      @include anim-side-by-value(top, $coin-pile-tier-1-top)
    }

    @keyframes anim-enter-coin-pile-coin-3 {
      @include anim-side-by-value(top, $coin-pile-tier-2-top)
    }
    @keyframes anim-enter-coin-pile-coin-4 {
      @include anim-side-by-value(top, $coin-pile-tier-2-top)
    }

    @keyframes anim-enter-coin-pile-coin-5 {
      @include anim-side-by-value(top, $coin-pile-tier-3-top)
    }

    height: 28.57vw;
    width: 28.57vw;

    #coin-0 {
      left: -3.75em;
      top: $coin-pile-tier-0-top;
    }

    #coin-1 {
      right: -3.75em;
      top: $coin-pile-tier-0-top;
    }

    #coin-2 {
      top: $coin-pile-tier-1-top;
    }

    #coin-3 {
      top: -2em;
      left: $coin-pile-tier-2-top;
    }

    #coin-4 {
      top: -2em;
      right: $coin-pile-tier-2-top;
    }

    #coin-5 {
      top: $coin-pile-tier-3-top;
    }

    &.drop {

      $coin-drop-duration: (.3s, .3s, .35s, .275s, .275s, .25s);
      $coin-last-index: length($coin-drop-duration);

      $i: 0;
      @for $i from 0 to $coin-last-index {
        #coin-#{$i} {
          animation: forwards ease-in-out anim-enter-coin-pile-coin-#{$i} nth($coin-drop-duration, $i+1);
          animation-delay: ($i * .1s) + (($coin-last-index - $i) * $i * .01s);
        }
      }
    }
  }

  #thank-you {
    h1 {
      animation: running anim-flip-title ease-in-out .5s;
    }

    &.pre-anim {
      animation-play-state: paused;
      transform: rotateX(90deg);
    }
  }

  #thank-you,
  #well-done {
    &.hide {
      @include hide-h1(.25s);

      .bottle {
        animation: forwards ease-in-out anim-exit-bottle-to-top .5s;
      }
    }
  }

  #sign-up {
    h1 {
      bottom: 2.5em;
    }

    &.hide {
      @include hide-h1(.33s);

      /*.bottle {
        animation: forwards ease-in-out anim-exit-bottle-to-top .5s;
      }*/

      #form-sign-up .formfield {
        animation: forwards ease-in-out anim-exit-form-to-bottom .25s;
      }
    }
  }

  #play-ar {
    h1 {
      bottom: 0.125em;
    }

    .button {
      bottom: 4em;
      position: absolute;
    }

    .bottle{
      &:first-of-type,
      &:nth-of-type(2) {
        transform-origin: 50% 120%;
      }
    }

    &.hide {
      @include hide-h1(.125s);

      .bottle {
        animation: forwards ease-in-out anim-exit-bottle-to-top .5s;
      }

      .button {
        animation: forwards ease-in-out anim-exit-form-to-bottom .25s;
      }
    }
  }

  #ar-game {
    h1 {
      position: initial;
    }
  }

  #get-fave-coin {
    .coin {
      position: absolute;
      top: 19%;
    }

    &.hide {
      @include hide-h1(.25s);

      .coin {
        animation: forwards ease-in-out anim-exit-bottle-to-top .5s;
      }

      .details {
        animation: forwards ease-in-out anim-exit-form-to-bottom .165s;
      }

      #form-sign-up .formfield {
        animation: forwards ease-in-out anim-exit-form-to-bottom .125s;
      }
    }
  }

  #have-fave-coin {
    #coin-pile {
      top: -4.5em;

      &.is-raised {
        .coin {
          top: -19em;
        }
      }
    }

    .coin {
      position: absolute;
    }

      .details {
      bottom: 4.5em;
      font-size: 1.2em;
      padding: 0 .2em;
    }

    &.hide {
      .coin {
        animation: forwards ease-in-out anim-exit-coin-pile-to-top .5s;
      }
    }
  }

  #amazing {
  }
}